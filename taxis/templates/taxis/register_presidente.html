{% extends 'registration/base_login.html' %}
{% load static %}
{% load widget_tweaks %}

{# Título que aparecerá en la pestaña del navegador #}
{% block title %}
Crear cuenta - Presidente
{% endblock %}

{% block content %}
<div class="login-wrapper">

<style>
/* Envoltorio general que centra la tarjeta de registro en la pantalla */
.reg-wrapper {
  min-height: 100vh;
  width: 100vw;
  overflow-x: hidden;
  overflow-y: auto;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  padding: 40px 12px 30px 12px;
}

/* Imágenes de fondo (modo claro y oscuro) */
.reg-bg-img,
.reg-bg-img-dark {
  position: fixed;
  left: 0; top: 0;
  min-width: 100vw; min-height: 100vh;
  width: 100vw; height: 100vh;
  z-index: 0;
  pointer-events: none;
  user-select: none;
  object-fit: cover;
}
.reg-bg-img-dark { display: none; }
/* En modo oscuro se oculta el fondo claro y se muestra el oscuro */
body.modo-oscuro .reg-bg-img { display: none !important; }
body.modo-oscuro .reg-bg-img-dark { display: block !important; }

/* Tarjeta principal de registro (dos columnas) */
.reg-card {
  display: flex;
  width: 100%;
  max-width: 1040px;
  min-width: 320px;
  border-radius: 40px;
  overflow: hidden;
  background: #F8EBD9;
  z-index: 1;
  margin: 0 auto;
  position: relative;
  align-items: stretch;
  border: 3px solid #108531;
  box-shadow: 0 18px 55px rgba(9,71,25,0.32);
  transition: background 0.2s, color 0.2s, border 0.2s, box-shadow 0.2s;
}

/* Columna izquierda: contiene el formulario */
.reg-left {
  flex: 1.25;
  background: #169A3B;
  display: flex;
  flex-direction: column;
  justify-content: center;
  padding: 30px 32px 24px 32px;
  min-width: 260px;
  border-top-left-radius: 36px;
  border-bottom-left-radius: 36px;
  position: relative;
}

/* Columna derecha: info del rol y botón continuar */
.reg-right {
  flex: 0.9;
  background: #E3D2C3;
  display: flex;
  flex-direction: column;
  justify-content: center;
  padding: 32px 30px 40px 30px;
  min-width: 250px;
  border-top-right-radius: 36px;
  border-bottom-right-radius: 36px;
  position: relative;
}

/* Botón circular para volver a la selección de rol */
.reg-back {
  position: absolute;
  left: 24px;
  top: 22px;
  width: 42px;
  height: 42px;
  border-radius: 50%;
  border: 2px solid #108531;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  background: #169A3B;
  transition: background .15s, transform .08s, box-shadow .12s;
  text-decoration: none;
}
.reg-back-icon {
  width: 18px;
  height: 18px;
  border-left: 3px solid #FFFFFF;
  border-bottom: 3px solid #FFFFFF;
  transform: rotate(45deg); /* forma de flecha */
}
.reg-back:hover {
  background: #148135;
  box-shadow: 0 3px 9px rgba(5,60,19,0.28);
  transform: translateY(-1px);
}

/* Título y logo en la parte superior izquierda */
.reg-title {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 10px;
  margin-left: 86px;
}
.reg-title-logo img { width: 46px; height: 46px; }
.reg-title-text {
  font-family: 'Nunito', sans-serif;
  font-size: 1.9rem;
  font-weight: 900;
  color: #FFFFFF;
}

/* Contenedor donde se muestra un mensaje genérico de error del form */
.reg-alert-slot {
  margin: 0 18px 8px 18px;
  min-height: 0;
}
.reg-alert-slot .alert {
  padding: 6px 14px;
  margin-bottom: 0;
  font-size: 0.86rem;
  border-radius: 999px;
  text-align: center;
}

/* Grid vertical de campos del formulario */
.reg-form-grid {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-left: 10px;
  margin-right: 10px;
}
.reg-row { display: flex; gap: 10px; }
.reg-row-two > * { flex: 1; }  /* dos columnas iguales */

/* Estilo general de inputs y selects */
.reg-input,
.reg-select {
  border-radius: 999px;
  border: 2px solid #B6ECAD;
  font-size: 0.98rem;
  background: #FFFFFF;
  color: #333333;
  width: 100%;
  outline: none;
  transition: border-color 0.2s ease, box-shadow 0.2s ease, background 0.2s ease, transform 0.12s ease;
}
.reg-input { padding: 12px 20px; }

.reg-input:hover,
.reg-select:hover {
  box-shadow: 0 3px 9px rgba(0,0,0,0.12);
  transform: translateY(-1px);
}
.reg-input:focus,
.reg-select:focus {
  border-color: #2FA24F;
  box-shadow: 0 0 0 2px #2fa24f33;
  transform: translateY(-1px);
}

/* Borde rojo cuando hay error (se añade clase is-invalid desde JS/plantilla) */
input.is-invalid,
select.is-invalid,
.reg-password-flex.is-invalid {
  border-color: #ff4b4b !important;
}

/* Estilo de select con flecha hecha con gradientes */
.reg-select {
  padding: 11px 18px;
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  background-image:
    linear-gradient(45deg, transparent 50%, #2FA24F 50%),
    linear-gradient(135deg, #2FA24F 50%, transparent 50%);
  background-position:
    calc(100% - 16px) 50%,
    calc(100% - 10px) 50%;
  background-size: 8px 8px, 8px 8px;
  background-repeat: no-repeat;
}
.reg-select::-ms-expand { display: none; }

/* Contenedor especial para el campo de fecha (texto + icono + date oculto) */
.reg-date-wrapper { width:100%; }
.reg-date-inner{
  position:relative;
  width:100%;
}
.reg-date-input { padding-right: 40px; }

/* Botón transparente sobre el icono de calendario */
.reg-date-icon-btn {
  position: absolute;
  right: 14px;
  top: 50%;
  transform: translateY(-50%);
  width: 22px;
  height: 22px;
  border: none;
  background: transparent;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  cursor: pointer;
}

/* Icono visual del calendario, dibujado con CSS */
.reg-date-icon {
  position: relative;
  width: 18px;
  height: 18px;
  border-radius: 4px;
  border: 2px solid #2FA24F;
  background: #ffffff;
  box-sizing: border-box;
}
.reg-date-icon::before,
.reg-date-icon::after {
  content: "";
  position: absolute;
  left: 2px;
  right: 2px;
}
.reg-date-icon::before {
  top: 2px;
  height: 4px;
  background: #2FA24F;
  border-radius: 2px 2px 0 0;
}
.reg-date-icon::after {
  top: 8px;
  bottom: 2px;
  border-top: 2px solid #2FA24F;
  border-bottom: 0;
}

/* Input date nativo oculto; solo se usa para mostrar el selector */
.reg-native-date {
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  opacity: 0;
  pointer-events: none;
}

/* Mensaje de error específico para fecha inválida */
.reg-date-error {
  font-size: 0.8rem;
  margin-top: 0;
  color: #dd1919ff;
}

/* Contenedor de contraseña con ojo (input + botón) */
.reg-password-flex{
  position:relative;
  display:flex;
  align-items:center;
  border-radius:999px;
  border:2px solid #B6ECAD;
  background:#FFF;
  box-sizing:border-box;
  padding-right:10px;
  height:48px;
  overflow:hidden;
  transition:border-color .2s,box-shadow .2s,transform .12s ease;
  width:100%;
  max-width:100%;
}
.reg-password-flex::before {
  content: "";
  position: absolute;
  top: 4px;
  bottom: 4px;
  right: 38px;
  width: 1px;
  background: #ffffff;
  pointer-events: none;
}
/* En modo oscuro se mantiene el fondo blanco de la zona de contraseña */
body.modo-oscuro .reg-password-flex {
  background: #FFFFFF !important;
}
body.modo-oscuro .reg-password-flex::before { background: #FFFFFF; }

/* Input real de password dentro del contenedor */
.reg-password-flex input {
  all: unset;
  box-sizing: border-box;
  flex: 1;
  height: 100%;
  padding: 0 18px;
  font-size: 0.98rem;
  color: #333333;
  background: transparent;
}
.reg-password-flex input:focus {
  outline: none !important;
  border: none !important;
  box-shadow: none !important;
}

/* Efectos hover y focus del contenedor de contraseña */
.reg-password-flex:hover {
  box-shadow: 0 3px 9px rgba(0,0,0,0.12);
  transform: translateY(-1px);
}
.reg-password-flex:focus-within {
  border-color: #2FA24F;
  box-shadow: 0 0 0 2px #2fa24f33;
  transform: translateY(-1px);
}

/* Botón del “ojito” que alterna mostrar/ocultar contraseña */
.reg-password-toggle {
  width: 26px;
  height: 26px;
  margin-left: 4px;
  border: none;
  background: transparent;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  padding: 0;
}
.reg-password-toggle img {
  width: 18px;
  height: 18px;
  display: block;
  object-fit: contain;
}

/* Mensajes de error bajo campos y textos de ayuda */
.field-error {
  font-size: 0.8rem;
  margin-top: 0;
  color: #dd1919ff;
}
.field-help {
  font-size: 0.8rem;
  margin-top: 1px;  /* muy pegado al campo */
  color: #ebee59ff;
}
.password-help {
  font-size: 0.8rem;
  margin-top: 1px;
  color: #ebee59ff;
}
/* Texto donde se escribe la fuerza de la contraseña */
#password-strength {
  margin-top: 4px;
  font-size: 0.8rem;
  color: ebee59ff;
}
#password-strength-bar {
  height: 6px;
  border-radius: 999px;
  margin-top: 3px;
}

/* Icono de información del rol (lado derecho) */
.reg-info {
  position: absolute;
  right: 32px;
  top: 30px;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  border: 2px solid #108531;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #108531;
  font-weight: 700;
  font-size: .9rem;
  background: #f9f3ea;
  cursor: pointer;
  transition: background .15s, box-shadow .12s;
}
.reg-info:hover {
  background: #f0e2cf;
  box-shadow: 0 3px 8px rgba(0,0,0,0.18);
}

/* Tarjeta que describe el rol PRESIDENTE */
.reg-role-card {
  border-radius: 28px;
  border: 2px solid #2FA24F;
  background: #FFFFFF;
  padding: 20px 18px;
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-bottom: 22px;
}
.reg-role-icon {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: #2FA24F;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 10px;
}
.reg-role-icon img {
  width: 34px;
  height: 34px;
  display: block;
}
.reg-role-text {
  text-align: center;
  font-family: 'Nunito', sans-serif;
  font-weight: 800;
  font-size: 0.96rem;
  color: #238C35;
}

/* Botón principal “Continuar” (envía el formulario) */
.reg-right-btn {
  width: 100%;
  background: #30AE37;
  color: #FFFFFF;
  font-weight: 700;
  padding: 13px 0;
  font-size: 1rem;
  border-radius: 999px;
  border: none;
  cursor: pointer;
  transition: background 0.18s, box-shadow 0.18s, transform 0.12s;
}
.reg-right-btn:hover,
.reg-right-btn:focus {
  background: #258627;
  box-shadow: 0 0 0 2px #2fa24f33;
  transform: translateY(-1px);
}

/* Bloque inferior con enlace para iniciar sesión si ya tiene cuenta */
.reg-register-box {
  margin-top: 14px;
  font-size: 0.95rem;
  text-align: center;
}
.reg-no-account-text {
  color: #238C35;
  font-weight: 600;
  letter-spacing: 0.4px;
  margin-right: 6px;
}
.reg-register-highlight {
  background: #30AE37;
  color: #FFFFFF;
  padding: 2px 10px;
  border-radius: 16px;
  font-weight: 700;
  text-decoration: none;
  display: inline-block;
  transition: background 0.13s, color 0.13s, box-shadow 0.13s;
}
.reg-register-highlight:hover,
.reg-register-highlight:focus {
  background: #146410;
  color: #FFFFFF;
  text-decoration: underline;
  box-shadow: 0 0 0 2px #2fa24f33;
}

/* Backdrop y contenido del modal informativo del rol */
.reg-info-modal-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.45);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1300;
}
.reg-info-modal {
  background: #FFFFFF;
  border-radius: 18px;
  max-width: 420px;
  width: 90vw;
  padding: 20px 22px;
  box-shadow: 0 12px 40px rgba(0,0,0,0.35);
  font-size: 0.9rem;
  color: #333333;
}
.reg-info-modal h3 {
  font-family: 'Nunito', sans-serif;
  font-size: 1.05rem;
  font-weight: 800;
  margin-bottom: 10px;
  color: #238C35;
}
.reg-info-modal ul {
  padding-left: 18px;
  margin-bottom: 10px;
}
.reg-info-modal-close {
  margin-top: 8px;
  display: inline-block;
  background: #30AE37;
  color: #FFFFFF;
  padding: 6px 14px;
  border-radius: 999px;
  font-size: 0.85rem;
  border: none;
  cursor: pointer;
}

/* Botón flotante para tema claro/oscuro */
.theme-toggle-btn {
  position: fixed;
  top: 23px;
  right: 32px;
  z-index: 1200;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: #F9F9FB;
  color: #30AE37;
  box-shadow: 0 2px 8px #238c3520;
  border: 2px solid #D8EDD6;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 2rem;
  transition: background 0.18s, color 0.16s, border 0.15s;
}
body.modo-oscuro .theme-toggle-btn {
  background: #232D21;
  color: #97F088;
  border: 2px solid #297B36;
}
.theme-toggle-btn img {
  width: 32px;
  height: 32px;
  display: block;
  pointer-events: none;
}
.theme-toggle-btn:focus { outline: 3px solid #97F08888; }

/* ==== AJUSTES RESPONSIVE BÁSICOS PARA REGISTRO ==== */

/* Evitar scroll horizontal en móvil */
html, body {
  width: 100%;
  max-width: 100%;
  overflow-x: hidden;
}

/* Asegurar que la tarjeta nunca sea más ancha que la pantalla */
.reg-card {
  box-sizing: border-box;
}

/* Las filas con dos columnas se apilan en pantallas pequeñas */
@media (max-width: 600px) {
  .reg-row {
    flex-wrap: wrap;
  }

  .reg-row-two > * {
    flex: 1 1 100%;
  }

  /* Espacio entre columnas cuando se apilan */
  .reg-row-two > * + * {
    margin-top: 8px;
  }

  /* Inputs/selects/contraseñas ocupan todo el ancho */
  .reg-input,
  .reg-select,
  .reg-password-flex {
    width: 100%;
  }
}

/* Ajustar flecha y título en móviles */
@media (max-width: 600px) {
  .reg-back {
    left: 16px;
    top: 16px;
    width: 36px;
    height: 36px;
  }

  .reg-title {
    margin-left: 64px;
  }

  .reg-title-logo img {
    width: 40px;
    height: 40px;
  }

  .reg-title-text {
    font-size: 1.5rem;
  }
}

</style>

<style>
  /* Ajustes de modo oscuro para tarjeta y elementos clave */
body.modo-oscuro .reg-card {
  background: #22322f !important;
  border-color: #00a744 !important;
  box-shadow: 0 0px 70px #0b141077;
}
body.modo-oscuro .reg-left { background: #1E3A33 !important; }
body.modo-oscuro .reg-right { background: #22322F !important; }
body.modo-oscuro .reg-title-text { color: #FFFFFF !important; }

/* Inputs en modo oscuro, con borde verde neón */
body.modo-oscuro .reg-input {
  background: #FFFFFF !important;
  color: #113010 !important;
  border-color: #00FF5A !important;
}
body.modo-oscuro .reg-input:focus {
  box-shadow: 0 0 0 2px #00ff5a44 !important;
}

/* Select en modo oscuro (flecha y borde verdes) */
body.modo-oscuro .reg-select {
  border-color: #00FF5A !important;
  background-image:
    linear-gradient(45deg, transparent 50%, #00FF5A 50%),
    linear-gradient(135deg, #00FF5A 50%, transparent 50%);
}

/* Contenedor de contraseña en modo oscuro */
body.modo-oscuro .reg-password-flex {
  border-color: #00FF5A !important;
  background: #FFFFFF !important;
  box-shadow: none !important;
}
body.modo-oscuro .reg-password-flex:focus-within {
  border-color: #00FF5A !important;
  box-shadow: none !important;
}

/* Campos con error siguen en rojo incluso en modo oscuro */
body.modo-oscuro input.is-invalid,
body.modo-oscuro select.is-invalid,
body.modo-oscuro .reg-password-flex.is-invalid {
  border-color: #ff4b4b !important;
}

/* Textos de ayuda de contraseña en modo oscuro */
body.modo-oscuro .password-help,
body.modo-oscuro #password-strength {
  color: #ebee59ff;
}

/* Tarjeta de rol en modo oscuro */
body.modo-oscuro .reg-role-card {
  background: #1A2723 !important;
  border-color: #00FF5A !important;
}
body.modo-oscuro .reg-role-text { color: #DBDEDB !important; }

/* Botón Continuar en modo oscuro */
body.modo-oscuro .reg-right-btn {
  background: #00A53A !important;
  color: #FFFFFF !important;
}
body.modo-oscuro .reg-right-btn:hover { background: #146410 !important; }

/* Modal de info en modo oscuro */
body.modo-oscuro .reg-info-modal {
  background: #1E2724 !important;
  color: #E5E5E5 !important;
}

/* Icono “i” y botón atrás en modo oscuro */
body.modo-oscuro .reg-info {
  background: #192722;
  color: #71ff9e;
  border-color: #71ff9e;
}
body.modo-oscuro .reg-back {
  background: #22322f;
  border-color: #71ff9e;
}
body.modo-oscuro .reg-back-icon {
  border-left-color: #71ff9e;
  border-bottom-color: #71ff9e;
}

/* Icono de calendario en modo oscuro */
body.modo-oscuro .reg-date-icon { border-color: #00FF5A; }
body.modo-oscuro .reg-date-icon::before { background: #00FF5A; }
body.modo-oscuro .reg-date-icon::after { border-top-color: #00FF5A; }

/* Layout vertical cuando la pantalla es <=1000px */
@media (max-width: 1000px) {
  .reg-card {
    flex-direction: column !important;
    max-width: 98vw !important;
    min-width: unset !important;
    height: unset !important;
    margin: 2vh auto !important;
  }
  .reg-left,
  .reg-right {
    border: none !important;
    height: auto !important;
    min-height: unset !important;
    padding: 24px 20px !important;
  }
}

/* Ajustes extra para móviles pequeños */
@media (max-width: 480px) {
  .reg-card { border-radius: 30px; }
  .reg-left { padding: 24px 18px 18px 18px !important; }
  .reg-right { padding: 22px 18px 24px 18px !important; }
  .reg-title { margin-left: 72px; }
  .reg-title-text { font-size: 1.6rem; }
  .reg-title-logo img { width: 40px; height: 40px; }
  .reg-back { left: 18px; top: 18px; width: 38px; height: 38px; }
  .theme-toggle-btn { top: 18px; right: 18px; }
  .reg-input { padding: 11px 18px; font-size: 0.94rem; }
  .reg-select { padding: 10px 16px; font-size: 0.94rem; }
  .password-help, #password-strength { font-size: 0.75rem; }
  .reg-role-card { padding: 18px 14px; }
  .reg-role-icon { width: 54px; height: 54px; }
  .reg-role-icon img { width: 30px; height: 30px; }
  .reg-role-text { font-size: 0.9rem; }
  .reg-register-box { font-size: 0.9rem; }
  .reg-no-account-text { display: block; margin-bottom: 4px; }
}

/* Fila que contiene los dos campos de contraseña */
.reg-row-passwords {
  gap:2px;
}

/* Error genérico de campo (redefinido para consistencia) */
.field-error {
  font-size: 0.8rem;
  margin-top: 0;
  color: #dd1919ff;
}

/* Forzar que el error de contraseña quede en una sola línea */
.password-error-one-line {
  white-space: nowrap;
}
</style>

<!-- Fondos de la página -->
<img src="{% static 'img/fondo-ondas.png' %}" alt="Fondo ondas claro" class="reg-bg-img">
<img src="{% static 'img/fondo-oscuro.png' %}" alt="Fondo ondas oscuro" class="reg-bg-img-dark">

<!-- Botón de tema claro/oscuro -->
<button type="button" class="theme-toggle-btn" id="themeToggleBtn" aria-label="Alternar tema">
  <img id="iconSunMoon" src="{% static 'img/theme-toggle.png' %}" alt="Tema claro/oscuro">
</button>
<script>
/* Alterna el modo oscuro/claro y guarda la preferencia en localStorage */
(function(){
  const btn = document.getElementById("themeToggleBtn");
  const img = document.getElementById("iconSunMoon");
  let modo = localStorage.getItem('modo-oscuro') === 'true';
  if(modo){
    document.body.classList.add('modo-oscuro');
    img.style.filter="invert(0.7)";
  }
  btn.onclick = function() {
    modo = !modo;
    document.body.classList.toggle('modo-oscuro');
    localStorage.setItem('modo-oscuro', modo ? 'true' : '');
    img.style.filter = modo ? "invert(0.7)" : "";
  };
})();
</script>

<!-- Modal con información sobre el rol PRESIDENTE -->
<div class="reg-info-modal-backdrop" id="infoModal">
  <div class="reg-info-modal">
    <h3>Información sobre el rol Presidente</h3>
    <ul>
      <li>Rol para el presidente o representante principal de la cooperativa.</li>
      <li>Podrás gestionar a los asociados, conductores y vehículos registrados.</li>
      <li>Tu acceso incluye funciones administrativas avanzadas del sistema.</li>
    </ul>
    <button type="button" class="reg-info-modal-close" id="infoModalClose">
      Entendido
    </button>
  </div>
</div>

<div class="reg-wrapper">
  <div class="reg-card">

    <!-- COLUMNA IZQUIERDA: formulario de registro -->
    <div class="reg-left">
      <a href="{% url 'taxis:select_role' %}" class="reg-back" aria-label="Volver a elegir rol">
        <span class="reg-back-icon"></span>
      </a>

      <div class="reg-title">
        <div class="reg-title-logo">
          <img src="{% static 'img/logo.png' %}" alt="Logo">
        </div>
        <div class="reg-title-text">Crear una cuenta</div>
      </div>

      <!-- Alerta general cuando el formulario tiene errores -->
      <div class="reg-alert-slot">
        {% if form.errors %}
          <div class="alert alert-danger" role="alert">
            Revisa los campos resaltados y completa la información requerida.
          </div>
        {% endif %}
      </div>

      <form method="post" novalidate autocomplete="off">
        {% csrf_token %}
        {# username y role viajan ocultos en el form #}
        {{ form.username }} {{ form.role }}

        <div class="reg-form-grid">

          <!-- Nombres y Apellidos -->
          <div class="reg-row reg-row-two">
            <div>
              {% render_field form.first_name class="reg-input" placeholder="Nombres" autocomplete="off" %}
              {% if form.first_name.errors %}
              <script>
              document.addEventListener('DOMContentLoaded',()=>{
                document.getElementsByName('{{ form.first_name.name }}')[0]?.classList.add('is-invalid');
              });
              </script>
              {% endif %}
            </div>
            <div>
              {% render_field form.last_name class="reg-input" placeholder="Apellidos" autocomplete="off" %}
              {% if form.last_name.errors %}
              <script>
              document.addEventListener('DOMContentLoaded',()=>{
                document.getElementsByName('{{ form.last_name.name }}')[0]?.classList.add('is-invalid');
              });
              </script>
              {% endif %}
            </div>
          </div>

          <!-- Fecha de nacimiento (texto con máscara + calendar nativo oculto) -->
          <div class="reg-row">
            <div class="reg-date-wrapper">
              <div class="reg-date-inner">
                {% render_field form.fecha_nacimiento class="reg-input reg-date-input" autocomplete="off" data-mask-fecha="true" placeholder="dd/mm/aaaa" %}
                {% if form.fecha_nacimiento.errors %}
                <script>
                document.addEventListener('DOMContentLoaded', () => {
                  const el = document.getElementsByName('{{ form.fecha_nacimiento.name }}')[0];
                  if (el) el.classList.add('is-invalid');
                });
                </script>
                {% endif %}

                <input type="date" id="nativeDate" class="reg-native-date">
                <button type="button"
                        class="reg-date-icon-btn"
                        id="dateIconBtn"
                        aria-label="Abrir calendario">
                  <span class="reg-date-icon"></span>
                </button>
              </div>

              {% if form.fecha_nacimiento.errors %}
                {% for e in form.fecha_nacimiento.errors %}
                  {% if "obligatorio" not in e %}
                    <div class="reg-date-error">
                      Fecha inválida. Verifica el día, mes y año.
                    </div>
                  {% endif %}
                {% endfor %}
              {% endif %}
            </div>
          </div>

          <!-- Género -->
          <div class="reg-row">
            <div style="width:100%;">
              {% render_field form.sexo class="reg-select" %}
              {% if form.sexo.errors %}
              <script>
              document.addEventListener('DOMContentLoaded',()=>{
                document.getElementsByName('{{ form.sexo.name }}')[0]?.classList.add('is-invalid');
              });
              </script>
              {% endif %}
            </div>
          </div>

          <!-- Teléfono: país (select + bandera) y número -->
          <div class="reg-row reg-row-two">
            <div style="display:flex; align-items:center; gap:8px;">
              {% if form.phone_country %}
                {% render_field form.phone_country class="reg-select" id="id_phone_country_pres" %}
                <img id="phoneFlagPresidente"
                     src="{% static 'img/flags/ve.png' %}"
                     alt="Bandera país"
                     style="width:24px; height:24px; border-radius:50%; object-fit:cover;">
                {% if form.phone_country.errors %}
                <script>
                document.addEventListener('DOMContentLoaded',()=>{
                  document.getElementsByName('{{ form.phone_country.name }}')[0]?.classList.add('is-invalid');
                });
                </script>
                {% endif %}
              {% endif %}
            </div>
            <div>
              {% if form.phone_number %}
                {% render_field form.phone_number class="reg-input" autocomplete="off" placeholder="Número de teléfono" %}
                {% if form.phone_number.errors %}
                <script>
                document.addEventListener('DOMContentLoaded',()=>{
                  document.getElementsByName('{{ form.phone_number.name }}')[0]?.classList.add('is-invalid');
                });
                </script>
                <div class="field-error">{{ form.phone_number.errors.0 }}</div>
                {% endif %}
              {% endif %}
            </div>
          </div>

          <!-- Correo electrónico -->
          <div class="reg-row">
            <div style="width:100%;">
              {% render_field form.email class="reg-input" placeholder="Correo electrónico" autocomplete="off" %}
              {% if form.email.errors %}
              <script>
              document.addEventListener('DOMContentLoaded',()=>{
                document.getElementsByName('{{ form.email.name }}')[0]?.classList.add('is-invalid');
              });
              </script>
              <div class="field-error">{{ form.email.errors.0 }}</div>
              {% endif %}
            </div>
          </div>

          <!-- Contraseñas: contraseña + confirmación, con ojos -->
          <div class="reg-row reg-row-two reg-row-passwords">
            <div>
              <div class="reg-password-flex
                          {% if form.password1.errors or form.password2.errors %} is-invalid{% endif %}">
                {% render_field form.password1 id="id_password1" placeholder="Contraseña" autocomplete="new-password" minlength="6" maxlength="20" %}
                <button type="button"
                        class="reg-password-toggle"
                        data-target="id_password1"
                        data-visible="false"
                        aria-label="Mostrar u ocultar contraseña">
                  <img src="{% static 'img/mostrar_contrasena.png' %}" alt="Mostrar contraseña">
                </button>
              </div>

              {% if form.password1.errors or form.password2.errors %}
              <div class="field-error password-error-one-line">
                {% if form.password2.errors %}
                  {{ form.password2.errors.0 }}
                {% else %}
                  {{ form.password1.errors.0 }}
                {% endif %}
              </div>
              {% endif %}

              <div class="field-help">
                Mínimo 6 caracteres, máximo 20.
              </div>
            </div>

            <div>
              <div class="reg-password-flex
                          {% if form.password1.errors or form.password2.errors %} is-invalid{% endif %}">
                {% render_field form.password2 id="id_password2" placeholder="Confirmar contraseña" autocomplete="new-password" minlength="6" maxlength="20" %}
                <button type="button"
                        class="reg-password-toggle"
                        data-target="id_password2"
                        data-visible="false"
                        aria-label="Mostrar u ocultar contraseña">
                  <img src="{% static 'img/mostrar_contrasena.png' %}" alt="Mostrar contraseña">
                </button>
              </div>
            </div>
          </div>

          <!-- Texto de ayuda y medidor de fuerza de contraseña -->
          <div class="reg-row">
            <div style="width:100%;">
              <div class="password-help">
                La contraseña se considera más segura con caracteres, mayúsculas, números y símbolos.
              </div>
              <div id="password-strength"></div>
            </div>
          </div>

        </div>
      </form>
    </div>

    <!-- COLUMNA DERECHA: información del rol + botón para enviar -->
    <div class="reg-right">
      <button type="button" class="reg-info" id="infoBtn">i</button>

      <div class="reg-role-card">
        <div class="reg-role-icon">
          <img src="{% static 'img/icono_presidente.png' %}" alt="Presidente">
        </div>
        <div class="reg-role-text">
          PRESIDENTE<br>DE LA COOPERATIVA
        </div>
      </div>

      <!-- Botón que dispara el submit del formulario de la izquierda -->
      <button type="submit" class="reg-right-btn" onclick="document.querySelector('.reg-left form').submit();">
        Continuar
      </button>

      <div class="reg-register-box">
        <span class="reg-no-account-text">¿Ya tienes una cuenta?</span>
        <a href="{% url 'login' %}" class="reg-register-highlight">Inicia sesión aquí</a>
      </div>
    </div>

  </div>
</div>

<script>
/* Máscara de fecha, máscara de teléfono y limpieza de errores visuales */
document.addEventListener('input', function(e){
  const el = e.target;

  // Aplica formato dd/mm/aaaa al escribir fecha
  if (el.hasAttribute('data-mask-fecha')) {
    let v = el.value.replace(/[^0-9]/g,'').slice(0,8);
    if (v.length >= 5) {
      el.value = v.slice(0,2) + '/' + v.slice(2,4) + '/' + v.slice(4);
    } else if (v.length >= 3) {
      el.value = v.slice(0,2) + '/' + v.slice(2);
    } else {
      el.value = v;
    }
  }

  // Teléfono: solo dígitos, máximo 11, con guión después de 3 (XXX-XXXX...)
  if (el.name === '{{ form.phone_number.name }}') {
    let v = el.value.replace(/[^0-9]/g,'').slice(0,11);
    el.value = v.length > 3 ? v.slice(0,3) + '-' + v.slice(3) : v;
  }

  // Al escribir, se quita la marca de error visual
  if (el.classList.contains('is-invalid')) {
    el.classList.remove('is-invalid');
  }
  const pwdWrapper = el.closest('.reg-password-flex');
  if (pwdWrapper && pwdWrapper.classList.contains('is-invalid')) {
    pwdWrapper.classList.remove('is-invalid');
  }
});

/* Cálculo de “fuerza” de contraseña (solo informativo para el usuario) */
document.addEventListener('input', function(e){
  if (e.target.name === '{{ form.password1.name }}') {
    const pwd = e.target.value || '';
    const box = document.getElementById('password-strength');
    if (!box) return;
    let score = 0;
    if (pwd.length >= 8) score++;
    if (/[A-Z]/.test(pwd)) score++;
    if (/[0-9]/.test(pwd)) score++;
    if (/[^A-Za-z0-9]/.test(pwd)) score++;
    let text = 'Contraseña muy débil';
    let color = '#ff4b4b';
    if (score === 2) { text = 'Un poco débil'; color = '#ffb347'; }
    if (score === 3) { text = 'Aceptable'; color = '#ffd800'; }
    if (score >= 4) { text = 'Segura'; color = '#8afc08ff'; }
    box.innerHTML = `
      <span>${text}</span>
      <div id="password-strength-bar" style="background:${color}; width:${(score/4)*100}%;"></div>
    `;
  }
});

/* Inicializa calendario nativo, modal de info y banderas de país */
document.addEventListener('DOMContentLoaded', function() {
  // Sincroniza input texto de fecha con el picker nativo
  const textDate = document.getElementsByName('{{ form.fecha_nacimiento.name }}')[0];
  const nativeDate = document.getElementById('nativeDate');
  const iconBtn = document.getElementById('dateIconBtn');
  if (iconBtn && nativeDate && textDate) {
    iconBtn.addEventListener('click', function(){
      try {
        if (nativeDate.showPicker) nativeDate.showPicker();
        else nativeDate.focus();
      } catch(e) {
        nativeDate.focus();
      }
    });
    nativeDate.addEventListener('change', function(){
      if (!nativeDate.value) return;
      const [y,m,d] = nativeDate.value.split('-');
      textDate.value = d + '/' + m + '/' + y;
    });
  }

  // Lógica para abrir/cerrar modal informativo del rol
  const infoBtn = document.getElementById('infoBtn');
  const modal = document.getElementById('infoModal');
  const closeBtn = document.getElementById('infoModalClose');
  if (infoBtn && modal) infoBtn.addEventListener('click', ()=> modal.style.display = 'flex');
  if (closeBtn && modal) closeBtn.addEventListener('click', ()=> modal.style.display = 'none');
  if (modal) {
    modal.addEventListener('click', function(e){
      if (e.target === modal) modal.style.display = 'none';
    });
  }

  // Banderas según el código de país del teléfono del presidente
  const select = document.getElementById('id_phone_country_pres');
  const flagImg = document.getElementById('phoneFlagPresidente');
  if (select && flagImg) {
    const flagMap = {
      "+58": "{% static 'img/flags/ve.png' %}",
      "+57": "{% static 'img/flags/co.png' %}",
      "+593": "{% static 'img/flags/ec.png' %}",
      "+51": "{% static 'img/flags/pe.png' %}",
      "+52": "{% static 'img/flags/mx.png' %}",
      "+54": "{% static 'img/flags/ar.png' %}",
      "+55": "{% static 'img/flags/br.png' %}",
      "+56": "{% static 'img/flags/cl.png' %}",
      "+505": "{% static 'img/flags/ni.png' %}",
      "+506": "{% static 'img/flags/cr.png' %}",
      "+591": "{% static 'img/flags/bo.png' %}",
      "+598": "{% static 'img/flags/uy.png' %}",
      "+595": "{% static 'img/flags/py.png' %}",
      "+502": "{% static 'img/flags/gt.png' %}",
      "+503": "{% static 'img/flags/sv.png' %}",
      "+504": "{% static 'img/flags/hn.png' %}",
      "+507": "{% static 'img/flags/pa.png' %}",
      "+53": "{% static 'img/flags/cu.png' %}",
      "+1809": "{% static 'img/flags/do.png' %}",
      "+1787": "{% static 'img/flags/pr.png' %}",
    };

    function updateFlag() {
      const code = select.value;
      if (flagMap[code]) {
        flagImg.src = flagMap[code];
      }
    }
    select.addEventListener('change', updateFlag);
    updateFlag();  // actualiza al cargar la página
  }
});

/* Lógica de los “ojos” para mostrar/ocultar contraseñas */
document.addEventListener('click', function(e){
  const btn = e.target.closest('.reg-password-toggle');
  if (!btn) return;
  const targetId = btn.getAttribute('data-target');
  const input = document.getElementById(targetId);
  if (!input) return;
  const visible = btn.getAttribute('data-visible') === 'true';
  const img = btn.querySelector('img');
  if (visible) {
    input.type = 'password';
    btn.setAttribute('data-visible', 'false');
    img.src = "{% static 'img/mostrar_contrasena.png' %}";
    img.alt = "Mostrar contraseña";
  } else {
    input.type = 'text';
    btn.setAttribute('data-visible', 'true');
    img.src = "{% static 'img/ocultar_contrasena.png' %}";
    img.alt = "Ocultar contraseña";
  }
});
</script>
</div>
{% endblock %}

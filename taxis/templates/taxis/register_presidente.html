{% extends 'registration/base_login.html' %}
{% load static %}
{% load widget_tweaks %}

{# Título que aparecerá en la pestaña del navegador #}
{% block title %}
Crear cuenta - Presidente
{% endblock %}
{% block content %}

<style>
/* ==== LAYOUT GENERAL ==== */


/* Contenedor que centra la tarjeta de registro en la pantalla */
.reg-wrapper {
  min-height: 100vh;
  width: 100vw;
  overflow-x: hidden;
  overflow-y: auto;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  padding: 40px 12px 30px 12px;
}


/* Fondos de la página en modo claro / oscuro */
.reg-bg-img,
.reg-bg-img-dark {
  position: fixed;
  left: 0;
  top: 0;
  min-width: 100vw;
  min-height: 100vh;
  width: 100vw;
  height: 100vh;
  z-index: 0;
  pointer-events: none;
  user-select: none;
  object-fit: cover;
}


/* Mostrar solo el fondo claro por defecto */
.reg-bg-img { display: block; }
.reg-bg-img-dark { display: none; }


/* ==== TARJETA PRINCIPAL ==== */


/* Tarjeta principal con dos columnas (formulario + info rol) */
.reg-card {
  display: flex;
  width: 100%;
  max-width: 1040px;
  min-width: 320px;
  border-radius: 40px;
  overflow: hidden;
  background: #108531;
  z-index: 1;
  margin: 0 auto;
  position: relative;
  align-items: stretch;
  border: 3px solid #108531;
  box-shadow: 0 18px 55px rgba(5, 43, 14, 0.32);
  transition: background 0.2s, color 0.2s, border 0.2s, box-shadow 0.2s;
}


/* Columna izquierda: formulario (presidente/asociado) */
.reg-left {
  flex: 1.25;
  background: #008000;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: stretch;
  padding: 30px 32px 24px 32px;
  min-width: 260px;
  position: relative;
  z-index: 2;
}


/* Columna derecha: descripción del rol + botón + login */
.reg-right {
  flex: 0.9;
  background: #F3E1C9;
  display: flex;
  flex-direction: column;
  justify-content: center;
  padding: 32px 30px 40px 30px;
  min-width: 250px;
  position: relative;
  z-index: 1;
}


/* ==== BOTÓN FLECHA VOLVER ==== */


/* Botón circular arriba a la izquierda, solo contorno y flecha */
.reg-back {
  position: absolute;
  left: 18px;
  top: 18px;
  width: 42px;
  height: 42px;
  border-radius: 50%;
  border: 2px solid #108531;
  background: transparent;
  z-index: 10000;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: background .15s, transform .08s,
              box-shadow .12s, border-color .15s;
  text-decoration: none;
}


/* Flecha interna con el mismo verde de la tarjeta */
.reg-back-icon {
  width: 18px;
  height: 18px;
  border-left: 3px solid #108531;
  border-bottom: 3px solid #108531;
  transform: rotate(45deg);
}


/* Hover suave con halo verde y ligera elevación */
.reg-back:hover {
  background: rgba(15,179,65,0.09);
  border-color: #108531;
  box-shadow: 0 4px 10px rgba(5,60,19,0.32);
  transform: translateY(-1px);
}


/* ==== TÍTULO FORMULARIO ==== */


/* Contenedor logo + texto del título del formulario */
.reg-title {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  margin: 0 18px 18px 18px;
}


/* Logo pequeño redondo superior */
.reg-title-logo img {
  width: 56px;
  height: 56px;
}


/* Texto “Crear una cuenta” grande y centrado */
.reg-title-text {
  font-family: 'Nunito', sans-serif;
  font-size: 1.55rem;
  font-weight: 900;
  color: #e9f7ee;
  text-align: center;
  line-height: 1.1;
}


/* ==== MENSAJE GENERAL DE ERROR ==== */


.reg-alert-slot {
  margin: 0 18px 8px 18px;
  min-height: 0;
}
.reg-alert-slot .alert {
  padding: 6px 14px;
  margin-bottom: 0;
  font-size: 0.86rem;
  border-radius: 999px;
  text-align: center;
}


/* ==== FORMULARIO: GRID Y CAMPOS ==== */


/* Estructura vertical de las filas del formulario */
.reg-form-grid {
  display: flex;
  flex-direction: column;
  gap: 6px;
  margin: 0 18px 12px 18px;
}


/* Fila genérica horizontal */
.reg-row {
  display: flex;
  gap: 8px;
  align-items: center;
}


/* Fila con dos columnas (ej. nombre/apellido, contraseñas) */
.reg-row-two > * {
  flex: 1;
}


/* Pequeño ajuste a la primera fila para compactar */
.reg-form-grid > .reg-row:first-child {
  margin-bottom: -2px;
}


/* Inputs y selects con bordes redondos tipo píldora */
.reg-input,
.reg-select {
  border-radius: 999px;
  border: 2px solid #9BD18B;
  font-size: 0.9rem;
  background: #FFFFFF;
  color: #233326;
  width: 100%;
  outline: none;
  transition: border-color 0.2s ease, box-shadow 0.2s ease,
              background 0.2s ease, transform 0.12s ease;
}
.reg-input {
  padding: 10px 18px;
}


/* Hover y focus con leve sombra y desplazamiento */
.reg-input:hover,
.reg-select:hover {
  box-shadow: 0 3px 9px rgba(0,0,0,0.12);
  transform: translateY(-1px);
}
.reg-input:focus,
.reg-select:focus {
  border-color: #2FA24F;
  box-shadow: 0 0 0 2px #2fa24f33;
  transform: translateY(-1px);
}


/* Borde rojo cuando hay error de validación */
input.is-invalid,
select.is-invalid,
.reg-password-flex.is-invalid {
  border-color: #c02424ff !important;
}


/* Select con flecha personalizada */
.reg-select {
  padding: 11px 18px;
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  background-image:
    linear-gradient(45deg, transparent 50%, #2FA24F 50%),
    linear-gradient(135deg, #2FA24F 50%, transparent 50%);
  background-position:
    calc(100% - 16px) 50%,
    calc(100% - 10px) 50%;
  background-size: 8px 8px, 8px 8px;
  background-repeat: no-repeat;
}
.reg-select::-ms-expand {
  display: none;
}


/* ==== FECHA DE NACIMIENTO ==== */


.reg-date-wrapper {
  width: 100%;
}
.reg-date-inner {
  position: relative;
  width: 100%;
}
.reg-date-input {
  padding-right: 40px;
}


/* Botón de calendario sobre el input de fecha */
.reg-date-icon-btn {
  position: absolute;
  right: 14px;
  top: 50%;
  transform: translateY(-50%);
  width: 22px;
  height: 22px;
  border: none;
  background: transparent;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  cursor: pointer;
  transition: transform .08s, box-shadow .12s;
}
.reg-date-icon-btn:hover {
  transform: translateY(-52%);
  box-shadow: 0 2px 8px rgba(0,0,0,0.18);
}


/* Icono cuadrado de calendario */
.reg-date-icon {
  position: relative;
  width: 18px;
  height: 18px;
  border-radius: 4px;
  border: 2px solid #2FA24F;
  background: #ffffff;
  box-sizing: border-box;
}
.reg-date-icon::before,
.reg-date-icon::after {
  content: "";
  position: absolute;
  left: 2px;
  right: 2px;
}
.reg-date-icon::before {
  top: 2px;
  height: 4px;
  background: #2FA24F;
  border-radius: 2px 2px 0 0;
}
.reg-date-icon::after {
  top: 8px;
  bottom: 2px;
  border-top: 2px solid #2FA24F;
  border-bottom: 0;
}


/* Input date nativo oculto pero funcional */
.reg-native-date {
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  opacity: 0;
  pointer-events: none;
}


/* Mensaje de error para fecha incorrecta */
.reg-date-error {
  font-size: 0.8rem;
  margin-top: 0;
  color: #c02424ff;
}


/* ==== CONTRASEÑAS ==== */


/* Contenedor tipo píldora con ojo a la derecha */
.reg-password-flex {
  position: relative;
  display: flex;
  align-items: center;
  border-radius: 999px;
  border: 2px solid #9BD18B;
  background: #FFF;
  box-sizing: border-box;
  padding-right: 14px;
  height: 48px;
  overflow: hidden;
  transition: border-color .2s, box-shadow .2s, transform .12s ease;
  width: 100%;
  max-width: 100%;
}


/* Eliminar completamente la línea separadora anterior */
.reg-password-flex::before {
  content: none !important;
}


/* Tapar el borde en la zona del ojo para que no se vea raya */
.reg-password-flex::after {
  content: "";
  position: absolute;
  top: 2px;
  bottom: 2px;
  right: 0;
  width: 42px;              /* ancho de la zona del ojo */
  background: #ffffff;      /* mismo color que el campo */
  border-radius: 0 999px 999px 0;
}


/* Input de contraseña dentro de la píldora */
.reg-password-flex input {
  all: unset;
  box-sizing: border-box;
  flex: 1;
  height: 100%;
  padding: 0 18px;
  font-size: 0.98rem;
  color: #333333;
  background: transparent;
  outline: none;
}


/* Efectos hover/focus del contenedor de contraseña */
.reg-password-flex:hover {
  box-shadow: 0 3px 9px rgba(0,0,0,0.12);
  transform: translateY(-1px);
}
.reg-password-flex:focus-within {
  border-color: #2FA24F;
  box-shadow: none;
  transform: translateY(-1px);
}


/* Botón del “ojito” */
.reg-password-toggle {
  width: 26px;
  height: 26px;
  margin-left: 6px;
  border: none;
  background: transparent;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  padding: 0;
}
.reg-password-toggle img {
  width: 18px;
  height: 18px;
  display: block;
  object-fit: contain;
}
.reg-password-toggle {
  position: relative;
  z-index: 2;  /* por encima del rectángulo blanco (::after) */
}


/* En escritorio, dos contraseñas 50/50 */
.reg-row-passwords > div:first-child,
.reg-row-passwords > div:last-child {
  max-width: 50%;
}
.reg-row.reg-row-two.reg-row-passwords {
  margin-left: 0;
  margin-right: 0;
}


/* Textos de ayuda bajo contraseña */
.field-help {
  font-size: 0.8rem;
  margin-top: 12px;
  margin-bottom: 2px;
  color: #ebee59ff;
}
.password-help {
  font-size: 0.8rem;
  margin-top: 4px;
  color: #ebee59ff;
}
#password-strength {
  margin-top: 4px;
  font-size: 0.8rem;
  color: #ebee59ff;
}
#password-strength-bar {
  height: 6px;
  border-radius: 999px;
  margin-top: 3px;
}


/* ==== TARJETA DEL ROL (COLUMNA DERECHA) ==== */


.reg-role-card {
  border-radius: 28px;
  border: 2px solid #2FA24F;
  background: #FFFFFF;
  padding: 20px 18px;
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-bottom: 22px;
  position: relative;
}


/* Icono grande del rol */
.reg-role-icon {
  width: 90px;
  height: 90px;
  border-radius: 22px;
  background: #ffffff;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 6px 18px rgba(0,0,0,0.18);
  margin-bottom: 12px;
}
.reg-role-icon img {
  width: 70px;
  height: 70px;
  object-fit: contain;
  margin-top: 2px;
}


/* Texto del rol */
.reg-role-text {
  text-align: center;
  font-family: 'Nunito', sans-serif;
  font-weight: 800;
  font-size: 0.96rem;
  color: #238C35;
}


/* Botón “i” de información dentro de la tarjeta */
.reg-info {
  position: absolute;
  top: 10px;
  right: 10px;
  width: 26px;
  height: 26px;
  border-radius: 50%;
  border: 2px solid #108531;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #108531;
  font-weight: 700;
  font-size: .85rem;
  background: #ffffffff;
  cursor: pointer;
  transition: background .15s, box-shadow .12s, transform .08s;
}
.reg-info:hover {
  background: #ffffffff;
  box-shadow: 0 3px 8px rgba(0,0,0,0.18);
  transform: translateY(-1px);
}


/* ==== MODAL INFORMACIÓN DEL ROL ==== */


.reg-info-modal-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.45);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1300;
}
.reg-info-modal {
  background: #FFFFFF;
  border-radius: 18px;
  max-width: 420px;
  width: 90vw;
  padding: 20px 22px;
  box-shadow: 0 12px 40px rgba(0,0,0,0.35);
  font-size: 0.9rem;
  color: #333333;
  position: relative;
}
.reg-info-modal h3 {
  font-family: 'Nunito', sans-serif;
  font-size: 1.05rem;
  font-weight: 800;
  margin-bottom: 10px;
  color: #008000;
}
.reg-info-modal ul {
  padding-left: 18px;
  margin-bottom: 10px;
}
.reg-info-modal-close {
  margin-top: 8px;
  display: inline-block;
  background: #30AE37;
  color: #FFFFFF;
  padding: 6px 14px;
  border-radius: 999px;
  font-size: 0.85rem;
  border: none;
  cursor: pointer;
}


/* ==== TELÉFONO Y BANDERA ==== */


.reg-phone-row {
  display: flex;
  align-items: center;
  gap: 4px;
}


/* Bandera pequeña a la derecha del select de país */
.phone-flag {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  object-fit: cover;
  display: inline-block;
  box-shadow: 0 2px 6px rgba(0,0,0,0.25);
  border: 2px solid transparent;
}
.reg-phone-row:hover .phone-flag {
  box-shadow: 0 3px 9px rgba(0,0,0,0.16);
  transform: translateY(-1px);
}


/* Evitar que el código de país se corte */
#id_phone_country_aso {
  padding-right: 32px;
  text-overflow: ellipsis;
  white-space: nowrap;
  overflow: hidden;
}


/* ==== BOTÓN PRINCIPAL Y LOGIN ==== */


/* Botón verde “Continuar” */
.reg-right-btn {
  width: 100%;
  background: #108531;
  color: #FFFFFF;
  font-weight: 700;
  padding: 11px 16px;
  font-size: 0.98rem;
  border-radius: 999px;
  border: none;
  cursor: pointer;
  white-space: nowrap;
  transition: background 0.18s, box-shadow 0.18s, transform 0.12s;
}
.reg-right-btn:hover,
.reg-right-btn:focus {
  background: #30AE37;
  box-shadow: 0 0 0 2px #2fa24f33;
  transform: translateY(-1px);
}


/* Bloque con texto “ya tienes cuenta / inicia sesión” */
.reg-register-box {
  margin-top: 14px;
  font-size: 0.95rem;
  text-align: center;
}
.reg-no-account-text {
  color: #30AE37;
  font-weight: 600;
  letter-spacing: 0.4px;
  margin-right: 6px;
}


/* Enlace “Inicia sesión aquí” con mismas transiciones del botón */
.reg-register-highlight {
  background: #108531;
  color: #FFFFFF;
  padding: 6px 14px;
  border-radius: 999px;
  font-weight: 700;
  text-decoration: none;
  display: inline-block;
  transition: background 0.18s, box-shadow 0.18s, transform 0.12s, color 0.13s;
}
.reg-register-highlight:hover,
.reg-register-highlight:focus {
  background: #108531;
  color: #FFFFFF;
  text-decoration: underline;
  box-shadow: 0 0 0 2px #2fa24f33;
  transform: translateY(-1px);
}


/* ==== BOTÓN TEMA CLARO/OSCURO ==== */


.theme-toggle-btn {
  position: absolute;
  top: 6px;
  right: 16px;
  z-index: 1200;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: #F9F9FB;
  color: #30AE37;
  box-shadow: 0 2px 8px #238c3520;
  border: 2px solid #D8EDD6;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 2rem;
  transition: background 0.18s, color 0.16s, border 0.15s,
              transform 0.08s, box-shadow 0.12s;
}
.theme-toggle-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px #238c3538;
}
.theme-toggle-btn img {
  width: 32px;
  height: 32px;
  display: block;
  pointer-events: none;
}
.theme-toggle-btn:focus {
  outline: 3px solid #97F08888;
}
 .reg-card {
    margin-top: 40px;
  }


/* ==== BASE HTML Y TARJETA ==== */


html, body {
  width: 100%;
  max-width: 100%;
  overflow-x: hidden;
}
.reg-card {
  box-sizing: border-box;
}


/* ==== RESPONSIVE TABLET ==== */


@media (max-width: 1000px) {
  .reg-card {
    flex-direction: column !important;
    max-width: 98vw !important;
    min-width: unset !important;
    height: unset !important;
    margin: 2vh auto !important;
  }
  .reg-left,
  .reg-right {
    height: auto !important;
    min-height: unset !important;
    padding: 24px 20px !important;
  }
}


/* ==== RESPONSIVE MÓVIL ==== */


@media (max-width: 600px) {
  .reg-row {
    flex-wrap: wrap;
  }
  .reg-row-two > * {
    flex: 1 1 100%;
  }
  .reg-row-two > * + * {
    margin-top: 8px;
  }


  .reg-input,
  .reg-select,
  .reg-password-flex {
    width: 100%;
  }


  /* Botón volver solo en móvil */
  .reg-back {
    top: 18px;          /* más separado del borde */
    left: 18px;
    width: 40px;        /* más grande */
    height: 40px;
    border-width: 2px;
    border-color: #fff; /* blanco */
    background: transparent;
  }


  .reg-back-icon {
    border-left-color: #fff;
    border-bottom-color: #fff;
  }


  .reg-back:hover {
    background: rgba(255,255,255,0.12);
    border-color: #fff;
  }


  .reg-title {
    flex-direction: column;
    text-align: center;
  }


  .reg-card {
    flex-direction: column;
  }
  .reg-left { order: 1; }
  .reg-right { order: 2; }


  .reg-form-grid .reg-row {
    margin-top: 6px;
  }
  .reg-form-grid .reg-row:first-child {
    margin-top: 0;
    margin-bottom: 0;
  }


  .reg-row-two.reg-row-passwords > div {
    flex: 1 1 100%;
    max-width: 100%;
  }

  /* FIX SOLO MÓVIL: más espacio para el ojo y sin corte */
  .reg-password-flex {
    height: 54px;
    padding-right: 48px;
  }
  .reg-password-flex::after {
    width: 48px;
  }
  .reg-password-toggle {
    width: 28px;
    height: 28px;
  }
  .reg-password-toggle img {
    width: 20px;
    height: 20px;
  }
}


/* ==== MODO OSCURO ==== */


/* Fondos en modo oscuro: se invierten */
body.modo-oscuro .reg-bg-img { display: none !important; }
body.modo-oscuro .reg-bg-img-dark { display: block !important; }


body.modo-oscuro .reg-card {
  background: #22322f !important;
  border-color: #00a744 !important;
  box-shadow: 0 0px 70px #0b141077;
}
body.modo-oscuro .reg-left {
  background: #1E3A33 !important;
}
body.modo-oscuro .reg-right {
  background: #22322F !important;
}
body.modo-oscuro .reg-title-text {
  color: #FFFFFF !important;
}
body.modo-oscuro .reg-input {
  background: #FFFFFF !important;
  color: #113010 !important;
  border-color: #00FF5A !important;
}
body.modo-oscuro .reg-input:focus {
  box-shadow: 0 0 0 2px #00ff5a44 !important;
}
body.modo-oscuro .reg-select {
  border-color: #00FF5A !important;
  background-image:
    linear-gradient(45deg, transparent 50%, #00FF5A 50%),
    linear-gradient(135deg, #00FF5A 50%, transparent 50%);
}
body.modo-oscuro .reg-password-flex {
  border-color: #00FF5A !important;
  background: #FFFFFF !important;
  box-shadow: none !important;
}
body.modo-oscuro .reg-password-flex:focus-within {
  border-color: #00FF5A !important;
  box-shadow: none !important;
}
body.modo-oscuro input.is-invalid,
body.modo-oscuro select.is-invalid,
body.modo-oscuro .reg-password-flex.is-invalid {
  border-color: #c92222ff !important;
}
body.modo-oscuro .password-help,
body.modo-oscuro #password-strength {
  color: #ebee59ff;
}
body.modo-oscuro .reg-role-card {
  background: #1A2723 !important;
  border-color: #00FF5A !important;
}
body.modo-oscuro .reg-role-text {
  color: #DBDEDB !important;
}
body.modo-oscuro .reg-right-btn {
  background: #00A53A !important;
  color: #FFFFFF !important;
}
body.modo-oscuro .reg-back {
  background: transparent;
  border-color: #71ff9e;
}
body.modo-oscuro .reg-back-icon {
  border-left-color: #71ff9e;
  border-bottom-color: #71ff9e;
}
body.modo-oscuro .reg-back:hover {
  background: rgba(113,255,158,0.10);
}
body.modo-oscuro .theme-toggle-btn {
  background: #232D21;
  color: #97F088;
  border: 2px solid #297B36;
}
body.modo-oscuro .reg-date-icon {
  border-color: #00FF5A;
}
body.modo-oscuro .reg-date-icon::before {
  background: #00FF5A;
}
body.modo-oscuro .reg-date-icon::after {
  border-top-color: #00FF5A;
}
body.modo-oscuro .reg-info-modal {
  background: #070808ff !important;
  color: #E5E5E5 !important;
}
body.modo-oscuro .reg-info {
  background: #192722;
  color: #71ff9e;
  border-color: #71ff9e;
}
body.modo-oscuro .reg-info:hover {
  background: #121b17ff;
  box-shadow: 0 3px 8px rgba(0,0,0,0.18);
  transform: translateY(-1px);
}


/* ==== ERRORES DE CAMPO ==== */


.field-error {
  font-size: 0.8rem;
  margin-top: 0;
  color: #c02424ff;
}
.password-error-one-line {
  white-space: nowrap;
}
</style>


{# Fondos de la página #}
<img src="{% static 'img/fondo-ondas.png' %}" alt="Fondo ondas claro" class="reg-bg-img">
<img src="{% static 'img/fondo-oscuro.png' %}" alt="Fondo ondas oscuro" class="reg-bg-img-dark">

{# Botón de tema claro/oscuro #}
<button type="button" class="theme-toggle-btn" id="themeToggleBtn" aria-label="Alternar tema">
  <img id="iconSunMoon" src="{% static 'img/theme-toggle.png' %}" alt="Tema claro/oscuro">
</button>

<script>
/* Alterna modo oscuro/claro y guarda preferencia en localStorage */
(function () {
  const btn = document.getElementById("themeToggleBtn");
  const img = document.getElementById("iconSunMoon");
  let modo = localStorage.getItem("modo-oscuro") === "true";

  if (modo) {
    document.body.classList.add("modo-oscuro");
    img.style.filter = "invert(0.7)";
  }

  btn.addEventListener("click", function () {
    modo = !modo;
    document.body.classList.toggle("modo-oscuro");
    localStorage.setItem("modo-oscuro", modo ? "true" : "");
    img.style.filter = modo ? "invert(0.7)" : "";
  });
})();
</script>

{# Modal de información sobre el rol Presidente #}
<div class="reg-info-modal-backdrop" id="infoModal">
  <div class="reg-info-modal">
    <h3>Información sobre el rol Presidente</h3>
    <ul>
      <li>Rol para el presidente o representante principal de la cooperativa.</li>
      <li>Permite gestionar asociados, conductores y vehículos registrados.</li>
      <li>Acceso a las funciones administrativas y paneles de control del sistema.</li>
    </ul>
    <button type="button" class="reg-info-modal-close" id="infoModalClose">
      Entendido
    </button>
  </div>
</div>

<div class="reg-wrapper">
  <div class="reg-card">

    {# Flecha para volver a seleccionar rol #}
    <a href="{% url 'taxis:select_role' %}" class="reg-back" aria-label="Volver a elegir rol">
      <span class="reg-back-icon"></span>
    </a>

      {# COLUMNA DERECHA: info rol + botón submit + enlace login #}
  <div class="reg-right">

    <div class="reg-role-card">
      {# Botón "i" DENTRO de la tarjetita blanca #}
      <button type="button"
              class="reg-info"
              id="infoBtn"
              aria-label="Información sobre el rol de presidente">
        i
      </button>

      <div class="reg-role-icon">
        <img src="{% static 'img/icono_presidente.png' %}" alt="Presidente">
      </div>
      <div class="reg-role-text">
        PRESIDENTE<br>DE LA COOPERATIVA
      </div>
    </div>

    {# Botón “Continuar” que envía el formulario de la columna verde (.reg-left) #}
    <button type="submit"
            class="reg-right-btn"
            onclick="document.querySelector('.reg-left form').submit();">
      Continuar
    </button>

    <div class="reg-register-box">
      <span class="reg-no-account-text">¿Ya tienes una cuenta?</span>
      <a href="{% url 'login' %}" class="reg-register-highlight">Inicia sesión aquí</a>
    </div>
  </div>


    {# COLUMNA IZQUIERDA: formulario completo #}
    <div class="reg-left">

      {# Título y logo del formulario #}
      <div class="reg-title">
        <div class="reg-title-logo">
          <img src="{% static 'img/logo.png' %}" alt="Logo">
        </div>
        <div class="reg-title-text">Crear una cuenta</div>
      </div>

      {# Mensaje de error general si el form tiene errores #}
      <div class="reg-alert-slot">
        {% if form.errors %}
          <div class="alert alert-danger" role="alert">
            Revisa los campos resaltados y completa la información requerida.
          </div>
        {% endif %}
      </div>

      {# Formulario que usa PresidenteRegisterForm #}
      <form method="post" novalidate autocomplete="off">
        {% csrf_token %}
        {{ form.username }} {{ form.role }}

        <div class="reg-form-grid">

          {# Nombres y apellidos #}
          <div class="reg-row reg-row-two">
            <div>
              {% render_field form.first_name class="reg-input" placeholder="Nombres" autocomplete="off" %}
              {% if form.first_name.errors %}
              <script>
              document.addEventListener('DOMContentLoaded', ()=>{
                document.getElementsByName('{{ form.first_name.name }}')[0]?.classList.add('is-invalid');
              });
              </script>
              {% endif %}
            </div>
            <div>
              {% render_field form.last_name class="reg-input" placeholder="Apellidos" autocomplete="off" %}
              {% if form.last_name.errors %}
              <script>
              document.addEventListener('DOMContentLoaded', ()=>{
                document.getElementsByName('{{ form.last_name.name }}')[0]?.classList.add('is-invalid');
              });
              </script>
              {% endif %}
            </div>
          </div>

          {# Fecha de nacimiento (texto + calendario nativo oculto) #}
          <div class="reg-row">
            <div class="reg-date-wrapper">
              <div class="reg-date-inner">
                {% render_field form.fecha_nacimiento class="reg-input reg-date-input" autocomplete="off" data-mask-fecha="true" placeholder="dd/mm/aaaa" %}
                {% if form.fecha_nacimiento.errors %}
                <script>
                document.addEventListener('DOMContentLoaded', () => {
                  const el = document.getElementsByName('{{ form.fecha_nacimiento.name }}')[0];
                  if (el) el.classList.add('is-invalid');
                });
                </script>
                {% endif %}

                <input type="date" id="nativeDate" class="reg-native-date">
                <button type="button"
                        class="reg-date-icon-btn"
                        id="dateIconBtn"
                        aria-label="Abrir calendario">
                  <span class="reg-date-icon"></span>
                </button>
              </div>

              {% if form.fecha_nacimiento.errors %}
                {% for e in form.fecha_nacimiento.errors %}
                  {% if "obligatorio" not in e %}
                    <div class="reg-date-error">
                      Fecha inválida. Verifica el día, mes y año.
                    </div>
                  {% endif %}
                {% endfor %}
              {% endif %}
            </div>
          </div>

          {# Género #}
          <div class="reg-row">
            <div style="width:100%;">
              {% render_field form.sexo class="reg-select" %}
              {% if form.sexo.errors %}
              <script>
              document.addEventListener('DOMContentLoaded', ()=>{
                document.getElementsByName('{{ form.sexo.name }}')[0]?.classList.add('is-invalid');
              });
              </script>
              {% endif %}
            </div>
          </div>

          {# Teléfono: país (con bandera) + número #}
          <div class="reg-row reg-row-two">
            <div class="reg-phone-row">
              {% if form.phone_country %}
                {% render_field form.phone_country class="reg-select" id="id_phone_country_aso" %}
                <img id="phoneFlagAsociado"
     class="phone-flag"
     src="{% static 'img/flags/ve.png' %}"
     alt="Bandera país">

                {% if form.phone_country.errors %}
                <script>
                document.addEventListener('DOMContentLoaded', ()=>{
                  document.getElementsByName('{{ form.phone_country.name }}')[0]?.classList.add('is-invalid');
                });
                </script>
                {% endif %}
              {% endif %}
            </div>
            <div>
              {% if form.phone_number %}
                {% render_field form.phone_number class="reg-input" autocomplete="off" placeholder="Número de teléfono" %}
                {% if form.phone_number.errors %}
                <script>
                document.addEventListener('DOMContentLoaded', ()=>{
                  document.getElementsByName('{{ form.phone_number.name }}')[0]?.classList.add('is-invalid');
                });
                </script>
                <div class="field-error">{{ form.phone_number.errors.0 }}</div>
                {% endif %}
              {% endif %}
            </div>
          </div>

          {# Correo electrónico #}
          <div class="reg-row">
            <div style="width:100%;">
              {% render_field form.email class="reg-input" placeholder="Correo electrónico" autocomplete="off" %}
              {% if form.email.errors %}
              <script>
              document.addEventListener('DOMContentLoaded', ()=>{
                document.getElementsByName('{{ form.email.name }}')[0]?.classList.add('is-invalid');
              });
              </script>
              <div class="field-error">{{ form.email.errors.0 }}</div>
              {% endif %}
            </div>
          </div>

          {# Contraseñas: contraseña + confirmación, cada una con ojo #}
          <div class="reg-row reg-row-two reg-row-passwords">
            <div>
              <div class="reg-password-flex
                          {% if form.password1.errors or form.password2.errors %} is-invalid{% endif %}">
                {% render_field form.password1 id="id_password1" placeholder="Contraseña" autocomplete="new-password" minlength="6" maxlength="20" %}
                <button type="button"
                        class="reg-password-toggle"
                        data-target="id_password1"
                        data-visible="false"
                        aria-label="Mostrar u ocultar contraseña">
                  <img src="{% static 'img/mostrar_contrasena.png' %}" alt="Mostrar contraseña">
                </button>
              </div>
            </div>

            <div>
              <div class="reg-password-flex
                          {% if form.password1.errors or form.password2.errors %} is-invalid{% endif %}">
                {% render_field form.password2 id="id_password2" placeholder="Confirmar contraseña" autocomplete="new-password" minlength="6" maxlength="20" %}
                <button type="button"
                        class="reg-password-toggle"
                        data-target="id_password2"
                        data-visible="false"
                        aria-label="Mostrar u ocultar contraseña">
                  <img src="{% static 'img/mostrar_contrasena.png' %}" alt="Mostrar contraseña">
                </button>
              </div>
            </div>
          </div>

          {# Mensaje de error único para las contraseñas #}
          {% if form.password1.errors or form.password2.errors %}
            <div class="field-error">
              {% if form.password2.errors %}
                {{ form.password2.errors.0 }}
              {% else %}
                {{ form.password1.errors.0 }}
              {% endif %}
            </div>
          {% endif %}

          {# Indicaciones de seguridad de contraseña + medidor visual #}
          <div class="reg-row">
            <div style="width:100%;">
              <div class="field-help">
                Mín. 6 caracteres, máx. 20.
              </div>
              <div class="password-help">
                La contraseña se considera más segura con caracteres, mayúsculas, números y símbolos.
              </div>
              <div id="password-strength"></div>
            </div>
          </div>

        </div> {# fin reg-form-grid #}
      </form>   {# fin form #}
    </div>      {# fin reg-left #}

  </div>
</div>

<script>
/*
  Máscaras para fecha y teléfono,
  y limpieza de errores visuales solo en contraseñas al escribir.
*/
document.addEventListener('input', function(e){
  const el = e.target;

  // Máscara dd/mm/aaaa para fecha
  if (el.hasAttribute('data-mask-fecha')) {
    let v = el.value.replace(/[^0-9]/g,'').slice(0,8);
    if (v.length >= 5) {
      el.value = v.slice(0,2) + '/' + v.slice(2,4) + '/' + v.slice(4);
    } else if (v.length >= 3) {
      el.value = v.slice(0,2) + '/' + v.slice(2);
    } else {
      el.value = v;
    }
  }

  // Solo dígitos en teléfono, con guión después de los 3 primeros
  if (el.name === '{{ form.phone_number.name }}') {
    let v = el.value.replace(/[^0-9]/g,'').slice(0,11);
    el.value = v.length > 3 ? v.slice(0,3) + '-' + v.slice(3) : v;
  }

  // Limpiar errores visuales en contraseñas al escribir
  if (el.name === '{{ form.password1.name }}' || el.name === '{{ form.password2.name }}') {
    if (el.classList.contains('is-invalid')) {
      el.classList.remove('is-invalid');
    }
    const pwdWrapper = el.closest('.reg-password-flex');
    if (pwdWrapper && pwdWrapper.classList.contains('is-invalid')) {
      pwdWrapper.classList.remove('is-invalid');
    }
  }
});

/* Indicador de fuerza de contraseña (solo informativo, no bloquea) */
document.addEventListener('input', function(e){
  if (e.target.name === '{{ form.password1.name }}') {
    const pwd = e.target.value || '';
    const box = document.getElementById('password-strength');
    if (!box) return;
    let score = 0;
    if (pwd.length >= 8) score++;
    if (/[A-Z]/.test(pwd)) score++;
    if (/[0-9]/.test(pwd)) score++;
    if (/[^A-Za-z0-9]/.test(pwd)) score++;
    let text = 'Contraseña muy débil';
    let color = '#ff4b4b';
    if (score === 2) { text = 'Un poco débil'; color = '#ffb347'; }
    if (score === 3) { text = 'Aceptable'; color = '#ffd800'; }
    if (score >= 4) { text = 'Segura'; color = '#8afc08ff'; }
    box.innerHTML = `
      <span>${text}</span>
      <div id="password-strength-bar" style="background:${color}; width:${(score/4)*100}%;"></div>
    `;
  }
});

/* Inicialización: calendario y banderas de país */
document.addEventListener('DOMContentLoaded', function() {
  // Calendario nativo enlazado al campo de texto
  const textDate = document.getElementsByName('{{ form.fecha_nacimiento.name }}')[0];
  const nativeDate = document.getElementById('nativeDate');
  const iconBtn = document.getElementById('dateIconBtn');
  if (iconBtn && nativeDate && textDate) {
    iconBtn.addEventListener('click', function(){
      try {
        if (nativeDate.showPicker) nativeDate.showPicker();
        else nativeDate.focus();
      } catch(e) {
        nativeDate.focus();
      }
    });
    nativeDate.addEventListener('change', function(){
      if (!nativeDate.value) return;
      const [y,m,d] = nativeDate.value.split('-');
      textDate.value = d + '/' + m + '/' + y;
      const wrapper = textDate.closest('.reg-date-wrapper');
      if (wrapper) {
        const err = wrapper.querySelector('.reg-date-error');
        if (err) err.remove();
      }
      textDate.classList.remove('is-invalid');
    });
  }

  // Actualizar bandera según teléfono (Presidente)
  const select = document.getElementById('id_phone_country_aso');
  const flagImg = document.getElementById('phoneFlagAsociado');
  if (select && flagImg) {
    const flagMap = {
      "+58": "{% static 'img/flags/ve.png' %}",
      "+57": "{% static 'img/flags/co.png' %}",
      "+593": "{% static 'img/flags/ec.png' %}",
      "+51": "{% static 'img/flags/pe.png' %}",
      "+52": "{% static 'img/flags/mx.png' %}",
      "+54": "{% static 'img/flags/ar.png' %}",
      "+55": "{% static 'img/flags/br.png' %}",
      "+56": "{% static 'img/flags/cl.png' %}",
      "+505": "{% static 'img/flags/ni.png' %}",
      "+506": "{% static 'img/flags/cr.png' %}",
      "+591": "{% static 'img/flags/bo.png' %}",
      "+598": "{% static 'img/flags/uy.png' %}",
      "+595": "{% static 'img/flags/py.png' %}",
      "+502": "{% static 'img/flags/gt.png' %}",
      "+503": "{% static 'img/flags/sv.png' %}",
      "+504": "{% static 'img/flags/hn.png' %}",
      "+507": "{% static 'img/flags/pa.png' %}",
      "+53": "{% static 'img/flags/cu.png' %}",
      "+1809": "{% static 'img/flags/do.png' %}",
      "+1787": "{% static 'img/flags/pr.png' %}",
    };

    function updateFlag() {
      const code = select.value;
      if (flagMap[code]) {
        flagImg.src = flagMap[code];
      }
    }
    select.addEventListener('change', updateFlag);
    updateFlag();
  }
});

/* Lógica de los “ojos” de contraseña (mostrar/ocultar) */
document.addEventListener('click', function(e){
  const btn = e.target.closest('.reg-password-toggle');
  if (!btn) return;
  const targetId = btn.getAttribute('data-target');
  const input = document.getElementById(targetId);
  if (!input) return;
  const visible = btn.getAttribute('data-visible') === 'true';
  const img = btn.querySelector('img');
  if (visible) {
    input.type = 'password';
    btn.setAttribute('data-visible', 'false');
    img.src = "{% static 'img/mostrar_contrasena.png' %}";
    img.alt = "Mostrar contraseña";
  } else {
    input.type = 'text';
    btn.setAttribute('data-visible', 'true');
    img.src = "{% static 'img/ocultar_contrasena.png' %}";
    img.alt = "Ocultar contraseña";
  }
});

// Modal de información sobre Presidente
document.addEventListener('DOMContentLoaded', function() {
  const infoBtn = document.getElementById('infoBtn');
  const modal = document.getElementById('infoModal');
  const closeBtn = document.getElementById('infoModalClose');

  if (infoBtn && modal) {
    infoBtn.addEventListener('click', function() {
      modal.style.display = 'flex';
    });
  }
  if (closeBtn && modal) {
    closeBtn.addEventListener('click', function() {
      modal.style.display = 'none';
    });
  }
  if (modal) {
    modal.addEventListener('click', function(e) {
      if (e.target === modal) {
        modal.style.display = 'none';
      }
    });
  }
});

</script>
{% endblock %}
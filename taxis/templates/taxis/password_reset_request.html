{% extends 'registration/base_login.html' %}
{% load static %}
{% load widget_tweaks %}

{# Título de la pestaña #}
{% block title %}Recuperar contraseña{% endblock %}

{% block content %}
<style>
/* --------------------------
   CONTENEDOR Y FONDOS
   -------------------------- */

/* Contenedor general que centra la tarjeta en la pantalla */
.vsms-wrapper {
  min-height: 100vh;
  width: 100vw;
  overflow-x: hidden;
  overflow-y: auto;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  padding: 40px 12px 30px 12px;
}

/* Imágenes de fondo (modo claro y oscuro) */
.vsms-bg-img,
.vsms-bg-img-dark {
  position: fixed;
  left: 0; top: 0;
  min-width: 100vw; min-height: 100vh;
  width: 100vw; height: 100vh;
  z-index: 0;
  pointer-events: none;
  user-select: none;
  object-fit: cover;
}
.vsms-bg-img-dark { display: none; }
body.modo-oscuro .vsms-bg-img { display: none !important; }
body.modo-oscuro .vsms-bg-img-dark { display: block !important; }

/* --------------------------
   TARJETA CENTRAL
   -------------------------- */

.vsms-card {
  display: flex;
  flex-direction: column;
  width: 100%;
  max-width: 640px;
  border-radius: 40px;
  overflow: hidden;
  background: #f1dfc7;
  z-index: 1;
  margin: 0 auto;
  border: 3px solid #00B543;
  box-shadow: 0 18px 55px rgba(0, 0, 0, 0.45);
  transition: background 0.2s, color 0.2s, border 0.2s, box-shadow 0.2s;
}
body.modo-oscuro .vsms-card {
  background: #142620;
  border-color: #00FF5A;
  box-shadow: 0 0 70px #000000aa;
}

/* Contenido interno de la tarjeta */
.vsms-left {
  flex: 1;
  padding: 32px 30px 28px 30px;
  position: relative;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

/* --------------------------
   BOTÓN ATRÁS
   -------------------------- */

.vsms-back {
  position: absolute;
  left: 24px;
  top: 22px;
  width: 42px;
  height: 42px;
  border-radius: 50%;
  border: 2px solid #00B543;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  background: transparent;
  transition: background .15s, transform .08s, box-shadow .12s;
  text-decoration: none;
}
.vsms-back-icon {
  width: 18px;
  height: 18px;
  border-left: 3px solid #00B543;
  border-bottom: 3px solid #00B543;
  transform: rotate(45deg);
}
.vsms-back:hover {
  background: rgba(0,0,0,0.03);
  box-shadow: 0 3px 9px rgba(0,0,0,0.25);
  transform: translateY(-1px);
}
body.modo-oscuro .vsms-back { border-color: #71FF9E; }
body.modo-oscuro .vsms-back-icon {
  border-left-color: #71FF9E;
  border-bottom-color: #71FF9E;
}

/* --------------------------
   TÍTULO + LOGO
   -------------------------- */

.vsms-title {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 10px;
  margin-left: 70px;
}
.vsms-title-logo img { width: 44px; height: 44px; }
.vsms-title-text {
  font-family: 'Nunito', sans-serif;
  font-size: 1.9rem;
  font-weight: 900;
  color: #149c3e;
}
body.modo-oscuro .vsms-title-text { color: #29FF66; }

/* --------------------------
   DESCRIPCIÓN
   -------------------------- */

.vsms-desc {
  margin-left: 70px;
  margin-right: 10px;
  margin-bottom: 14px;
  font-size: 0.92rem;
  color: #184321;
  line-height: 1.4;
}
body.modo-oscuro .vsms-desc { color: #E9FFE9; }

/* --------------------------
   FORMULARIO
   -------------------------- */

.vsms-form {
  margin-left: 40px;
  margin-right: 40px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

/* Input de correo con estilo tipo “píldora” */
.vsms-input {
  border-radius: 999px;
  border: 2px solid #6BE899;
  font-size: 0.96rem;
  background: #FFFFFF;
  color: #333333;
  width: 100%;
  padding: 12px 20px;
  outline: none;
  text-align: left;
  letter-spacing: 0;
  font-weight: 500;
  transition: border-color 0.2s ease, box-shadow 0.2s ease, transform 0.12s ease;
}
.vsms-input:hover {
  box-shadow: 0 3px 9px rgba(0,0,0,0.18);
  transform: translateY(-1px);
}
.vsms-input:focus {
  border-color: #00B543;
  box-shadow: 0 0 0 2px #00b54344;
  transform: translateY(-1px);
}
.vsms-input.is-invalid { border-color: #ff4b4b !important; }

/* Mensaje de error bajo el campo email */
.vsms-error {
  font-size: 0.8rem;
  margin-top: 4px;
  color: #cc1f1f;
  text-align: left;
}

/* --------------------------
   BOTÓN PRINCIPAL
   -------------------------- */

.vsms-btn {
  width: 100%;
  background: linear-gradient(90deg,#24c34f,#18a83f);
  color: #FFFFFF;
  font-weight: 700;
  padding: 13px 0;
  font-size: 1rem;
  border-radius: 999px;
  border: none;
  cursor: pointer;
  transition: background 0.18s, box-shadow 0.18s, transform 0.12s;
}
.vsms-btn:hover,
.vsms-btn:focus {
  background: linear-gradient(90deg,#1EA344,#148338);
  box-shadow: 0 0 0 2px #00b54344;
  transform: translateY(-1px);
}

/* Texto informativo al pie */
.vsms-help {
  margin-top: 10px;
  font-size: 0.86rem;
  text-align: center;
  color: #3c5a46;
}
body.modo-oscuro .vsms-help { color: #CFF5D8; }

/* --------------------------
   BOTÓN TEMA (CLARO/OSCURO)
   -------------------------- */

.theme-toggle-btn {
  position: fixed;
  top: 23px;
  right: 32px;
  z-index: 1200;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: #F9F9FB;
  color: #30AE37;
  box-shadow: 0 2px 8px #238c3520;
  border: 2px solid #D8EDD6;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 2rem;
  transition: background 0.18s, color 0.16s, border 0.15s, transform 0.08s, box-shadow 0.12s;
}

.theme-toggle-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px #238c3538;
}
body.modo-oscuro .theme-toggle-btn {
  background: #232D21;
  color: #97F088;
  border: 2px solid #297B36;
}
.theme-toggle-btn img {
  width: 32px;
  height: 32px;
  display: block;
  pointer-events: none;
}
.theme-toggle-btn:focus { outline: 3px solid #97F08888; }

/* --------------------------
   AJUSTES RESPONSIVE
   -------------------------- */

@media (max-width: 900px) {
  .vsms-left {
    padding: 28px 22px 24px 22px;
  }
  .vsms-title { margin-left: 50px; }
  .vsms-desc { margin-left: 50px; margin-right: 16px; }
}

@media (max-width: 900px) {
  .vsms-left {
    padding: 28px 22px 24px 22px;
  }
  .vsms-title { margin-left: 50px; }
  .vsms-desc { margin-left: 50px; margin-right: 16px; }
}

@media (max-width: 480px) {
  @media (max-width: 480px) {
  .role-panel {
    padding: 26px 18px 20px 18px;
    border-radius: 30px;
  }

  .role-back {
    left: 16px;
    top: 18px;
    width: 38px;
    height: 38px;
  }

  /* Logo más centrado horizontalmente */
  .role-logo {
    left: 50%;
    top: 20px;
    transform: translateX(-50%);
  }
  .role-logo img {
    width: 40px;
    height: 40px;
  }

  .role-info-badge {
    right: 20px;
    top: 20px;
  }

  /* Títulos centrados bajo el logo */
  .role-header-title {
    font-size: 1.6rem;
    margin-top: 72px;     /* baja el título para dejar espacio al logo centrado */
    text-align: center;
  }
  .role-header-sub {
    font-size: 1.1rem;
    margin-bottom: 1.4rem;
    text-align: center;
  }

  .role-card {
    width: 200px;
    height: 180px;
  }
  .role-card-icon {
    width: 82px;
    height: 82px;
  }
  .role-card-icon img {
    width: 68px;
    height: 68px;
  }
  .role-card-title {
    font-size: 0.8rem;
  }
  .role-next-btn {
    width: 200px;
    font-size: 0.96rem;
    padding: 9px 0;
  }
}

</style>

{# Imágenes de fondo #}
<img src="{% static 'img/fondo-ondas.png' %}" alt="Fondo ondas claro" class="vsms-bg-img">
<img src="{% static 'img/fondo-oscuro.png' %}" alt="Fondo ondas oscuro" class="vsms-bg-img-dark">

{# Botón para alternar modo claro/oscuro #}
<button type="button" class="theme-toggle-btn" id="themeToggleBtn" aria-label="Alternar tema">
  <img id="iconSunMoon" src="{% static 'img/theme-toggle.png' %}" alt="Tema claro/oscuro">
</button>
<script>
/*
  Alterna modo oscuro/claro y guarda la preferencia en localStorage.
*/
(function(){
  const btn = document.getElementById("themeToggleBtn");
  const img = document.getElementById("iconSunMoon");
  let modo = localStorage.getItem('modo-oscuro') === 'true';
  if (modo) { document.body.classList.add('modo-oscuro'); img.style.filter = "invert(0.7)"; }
  btn.onclick = function() {
    modo = !modo;
    document.body.classList.toggle('modo-oscuro');
    localStorage.setItem('modo-oscuro', modo ? 'true' : '');
    img.style.filter = modo ? "invert(0.7)" : "";
  };
})();
</script>

<div class="vsms-wrapper">
  <div class="vsms-card">
    <div class="vsms-left">

      {# Botón para volver al login #}
      <a href="{% url 'login' %}" class="vsms-back" aria-label="Volver al inicio de sesión">
        <span class="vsms-back-icon"></span>
      </a>

      {# Título con logo de la cooperativa #}
      <div class="vsms-title">
        <div class="vsms-title-logo">
          <img src="{% static 'img/logo.png' %}" alt="Logo cooperativa">
        </div>
        <div class="vsms-title-text">Recuperar contraseña</div>
      </div>

      {# Mensajes de error generales del formulario (non_field_errors) #}
      {% if form.non_field_errors %}
        <div class="vsms-error" style="margin-left:70px;margin-right:40px;margin-bottom:6px;">
          {{ form.non_field_errors.0 }}
        </div>
      {% endif %}

      {# Explicación del proceso de envío de código al correo #}
      <div class="vsms-desc">
        Ingresa el correo asociado a tu cuenta. 
        Si encontramos una cuenta activa con ese correo, te enviaremos un código de 6 dígitos
        para que puedas restablecer tu contraseña de forma segura.
      </div>

      {# Formulario: usa PasswordResetRequestForm con un solo campo email #}
      <form method="post" class="vsms-form" novalidate autocomplete="off">
        {% csrf_token %}
        <div>
          {# Campo de correo con estilos personalizados mediante widget_tweaks #}
          {% render_field form.email class="vsms-input" placeholder="Correo electrónico" autocomplete="off" %}
          {% if form.email.errors %}
          <script>
          // Marca el input de email como inválido si hay errores de validación
          document.addEventListener('DOMContentLoaded', ()=>{
            const el = document.getElementsByName('{{ form.email.name }}')[0];
            if (el) { el.classList.add('is-invalid'); }
          });
          </script>
          <div class="vsms-error">{{ form.email.errors.0 }}</div>
          {% endif %}
        </div>

        <button type="submit" class="vsms-btn">
          Enviar código al correo
        </button>
      </form>

      {# Nota de seguridad al pie #}
      <div class="vsms-help">
        Por seguridad, solo se enviará el código si el correo pertenece a una cuenta activa.
      </div>

    </div>
  </div>
</div>
{% endblock %}

{% extends 'registration/base_login.html' %}
{% load i18n %}
{% load static %}
{% load widget_tweaks %}

{# Título que aparecerá en la pestaña del navegador #}
{% block title %}Iniciar sesión{% endblock %}

{% block content %}
<style>
/* -------------------------------------------------
   ESTILOS PRINCIPALES PARA LA PANTALLA DE LOGIN
   ------------------------------------------------- */

/* Contenedor general que centra la tarjeta de login */
.login-wrapper {
  min-height: 100vh;
  width: 100vw;
  overflow-x: hidden;
  overflow-y: auto;
  display: flex;
  align-items: center;
  justify-content: center;
  background: none;
  position: relative;
  padding: 40px 12px 30px 12px;
}

/* Imágenes de fondo (modo claro y oscuro) */
.login-bg-img,
.login-bg-img-dark {
  position: fixed;
  left: 0; top: 0;
  min-width: 100vw; min-height: 100vh;
  width: 100vw; height: 100vh;
  z-index: 0;
  pointer-events: none;
  user-select: none;
  object-fit: cover;
}
.login-bg-img-dark { display: none; }
body.modo-oscuro .login-bg-img { display: none !important; }
body.modo-oscuro .login-bg-img-dark { display: block !important; }

/* Tarjeta principal de login (dos columnas: logo + formulario) */
.login-card {
  display: flex;
  width: 100%;
  max-width: 870px;
  border-radius: 36px;
  overflow: hidden;
  background: #F8EBD9;
  z-index: 1;
  margin: auto;
  position: relative;
  align-items: stretch;
  border: 2.6px solid #2FA24F;
  box-shadow: 0 12px 50px #0c4c1837;
  transition: background 0.2s, color 0.2s, border 0.2s, box-shadow 0.2s;
}

/* Lado del logo / información institucional (izquierda) */
.login-logo-side {
  flex: 1.05;
  background: #E3D2C3;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 38px 14px 32px 14px;
  min-width: 220px;
  min-height: 260px;
  transition: background 0.22s, color 0.22s;
}
.login-logo-side img {
  height: 79px;
  margin-bottom: 17px;
}
.login-title {
  font-family: 'Nunito', sans-serif;
  color: #238C35;
  font-weight: 900;
  text-align: center;
  font-size: 1.18rem;
  margin-bottom: 10px;
  line-height: 1.1;
}
.login-org {
  font-size: 1.44rem;
  color: #238C35;
  font-weight: 900;
  letter-spacing: 0.5px;
  margin-bottom: 0;
  white-space: nowrap;
}
.login-foot {
  margin-top: 13px;
  color: #787878;
  font-size: 14px;
}

/* Lado del formulario (derecha) */
.login-form-side {
  flex: 1.2;
  background: #FFFFFF;
  padding: 40px 30px 31px 31px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  min-width: 270px;
  border: none !important;
  transition: background 0.22s, color 0.22s;
}

/* Título de bienvenida */
.login-welcome {
  color: #238C35;
  font-weight: 900;
  font-family: 'Nunito',sans-serif;
  text-align: center;
  font-size: 30px;
  margin-bottom: 16px;
  letter-spacing: 1px;
  transition: color 0.22s, transform 0.18s, margin-bottom 0.18s;
}

/* Si hay error de formulario, el título se mueve ligeramente hacia arriba */
.login-form-side.has-error .login-welcome {
  transform: translateY(-6px);
  margin-bottom: 6px;
}

/* Contenedor para mensajes de error/alertas */
.login-alert-slot {
  min-height: 0;
  margin-bottom: 16px;
}
.login-alert-slot .alert {
  padding: 8px 14px;
  margin-bottom: 0;
  font-size: 0.9rem;
}

/* Efecto de foco en el contenedor del campo */
.login-field-wrap {
  position: relative;
  border-radius: 20px;
  transition: box-shadow 0.18s, transform 0.08s;
}
.login-field-wrap:has(input:focus) {
  box-shadow: 0 0 0 3px rgba(47,162,79,0.45);
  transform: translateY(-1px);
}

/* Campos de texto (usuario / email) */
.form-control {
  border-radius: 20px;
  padding: 15px 21px;
  font-size: 1.06rem;
  border: 2px solid #B6ECAD;
  background: #FFFFFF;
  color: #333333;
  transition: background 0.22s, color 0.22s, border-color 0.22s;
}
.form-control:focus {
  border-color: #2FA24F;
  box-shadow: 0 0 0 2px #2fa24f33;
}

/* Contenedor especial para el campo de contraseña + botón de ojo */
.login-password-wrap {
  display: flex;
  align-items: center;
  border-radius: 20px;
  border: 2px solid #B6ECAD;
  background: #FFFFFF;
  padding-right: 8px;
  box-sizing: border-box;
}
.login-password-wrap input.form-control {
  border: none;
  box-shadow: none;
  padding-right: 0;
}
.login-password-toggle {
  width: 30px;
  height: 30px;
  border: none;
  background: transparent;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  padding: 0;
}
.login-password-toggle img {
  width: 18px;
  height: 18px;
  object-fit: contain;
  display: block;
}
.login-password-wrap input.form-control:focus {
  border: none !important;
  box-shadow: none !important;
}

/* Botón principal "Iniciar sesión" */
.btn-green {
  width: 100%;
  background: #30AE37;
  color: #FFFFFF;
  font-weight: bold;
  padding: 14px 0;
  font-size: 19px;
  border-radius: 40px;
  margin-bottom: 12px;
  box-shadow: none;
  border: none;
  transition: background 0.18s, box-shadow 0.18s;
}
.btn-green:hover,
.btn-green:focus {
  background: #258627;
  color: #FFFFFF;
  box-shadow: 0 0 0 2px #2fa24f33;
}

/* Enlaces secundarios (olvidé mi contraseña, etc.) */
.login-link, .login-link:visited {
  color: #238C35;
  text-decoration: underline;
  margin-right: 16px;
  transition: color 0.15s;
}
.login-link:hover, .login-link:focus {
  color: #186324;
}

/* Bloque de registro (texto + botón) */
.register-box {
  margin-top: 12px;
  font-size: 16px;
  text-align: center;
}
.no-account-text {
  color: #238C35;
  font-weight: 600;
  letter-spacing: 0.5px;
  margin-right: 8px;
}
.register-highlight {
  background: #30AE37;
  color: #FFFFFF;
  padding: 2px 12px;
  border-radius: 16px;
  font-weight: 700;
  cursor: pointer;
  text-decoration: none;
  transition: background 0.13s, color 0.13s, box-shadow 0.13s;
  display: inline-block;
}
.register-highlight:hover, .register-highlight:focus {
  background: #146410;
  color: #FFFFFF;
  text-decoration: underline;
  box-shadow: 0 0 0 2px #2fa24f33;
}

/* Estilos de modo oscuro para la tarjeta de login y sus elementos */
body.modo-oscuro .login-card {
  background: #142923 !important;
  border-color: #00FF5A !important;
  box-shadow: 0 0px 70px #0b141077;
}
body.modo-oscuro .login-logo-side { background: #1A2723 !important; }
body.modo-oscuro .login-title,
body.modo-oscuro .login-org,
body.modo-oscuro .login-foot { color: #DBDEDB !important; }
body.modo-oscuro .login-form-side { background: #22322F !important; }
body.modo-oscuro .login-welcome { color: #DBDEDB !important; }
body.modo-oscuro .form-control {
  background: #FFFFFF !important;
  color: #113010 !important;
  border: 2px solid #00FF5A !important;
}
body.modo-oscuro .login-password-wrap {
  border-color: #00FF5A !important;
  background: #FFFFFF !important;
}
body.modo-oscuro .login-password-wrap input.form-control {
  border: none !important;
  box-shadow: none !important;
}
body.modo-oscuro .form-control::placeholder { color: #97AE98 !important; }
body.modo-oscuro .btn-green {
  background: #00A53A !important;
  color: #DBDEDB !important;
  box-shadow: none !important;
}
body.modo-oscuro .btn-green:hover,
body.modo-oscuro .btn-green:focus {
  background: #146410 !important;
  color: #FFFFFF !important;
}
body.modo-oscuro .login-link,
body.modo-oscuro .login-link:visited,
body.modo-oscuro .register-box .no-account-text { color: #DBDEDB !important; }
body.modo-oscuro .login-link:hover,
body.modo-oscuro .login-link:focus { color: #96FFB9 !important; }
body.modo-oscuro .register-highlight {
  background: #00A53A !important;
  color: #FFFFFF !important;
}
body.modo-oscuro .register-highlight:hover,
body.modo-oscuro .register-highlight:focus {
  background: #146410 !important;
  color: #FFFFFF !important;
}

/* Botón flotante para cambiar tema (claro/oscuro) */
.theme-toggle-btn {
  position: fixed;
  top: 23px;
  right: 32px;
  z-index: 1200;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: #F9F9FB;
  color: #30AE37;
  box-shadow: 0 2px 8px #238c3520;
  border: 2px solid #D8EDD6;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 2rem;
  transition: background 0.18s, color 0.16s, border 0.15s, transform 0.08s, box-shadow 0.12s;
}

.theme-toggle-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px #238c3538;
}

body.modo-oscuro .theme-toggle-btn {
  background: #232D21;
  color: #97F088;
  border: 2px solid #297B36;
}
.theme-toggle-btn img {
  width: 32px;
  height: 32px;
  pointer-events: none;
}

/* Responsive */
@media (max-width: 1000px) {
  .login-card {
    flex-direction: column !important;
    max-width: 98vw !important;
    margin: 2vh auto !important;
  }
  .login-logo-side,
  .login-form-side {
    padding: 24px 18px !important;
  }
}
@media (max-width: 480px) {
  .login-card { border-radius: 28px; }
  .login-logo-side { padding: 26px 10px 18px 10px !important; }
  .login-logo-side img { height: 64px; margin-bottom: 10px; }
  .login-title { font-size: 1rem; }
  .login-org { font-size: 1.2rem; }
  .login-foot { font-size: 12px; }
  .login-form-side { padding: 26px 18px 20px 18px !important; }
  .login-welcome { font-size: 1.4rem; margin-bottom: 12px; }
  .form-control { padding: 12px 18px; font-size: 0.98rem; }
  .btn-green { padding: 12px 0; font-size: 1rem; }
  .register-box { font-size: 0.9rem; }
  .no-account-text { display: block; margin-bottom: 6px; }
}
</style>

<img src="{% static 'img/fondo-ondas.png' %}" alt="Fondo ondas claro" class="login-bg-img">
<img src="{% static 'img/fondo-oscuro.png' %}" alt="Fondo ondas oscuro" class="login-bg-img-dark">

<button type="button" class="theme-toggle-btn" id="themeToggleBtn" aria-label="Alternar tema">
  <img id="iconSunMoon" src="{% static 'img/theme-toggle.png' %}" alt="Tema claro/oscuro">
</button>
<script>
(function(){
  const btn = document.getElementById("themeToggleBtn");
  const img = document.getElementById("iconSunMoon");
  let modo = localStorage.getItem('modo-oscuro') === 'true';
  if(modo){
    document.body.classList.add('modo-oscuro');
    img.style.filter="invert(0.7)";
  }
  btn.onclick = function() {
    modo = !modo;
    document.body.classList.toggle('modo-oscuro');
    localStorage.setItem('modo-oscuro', modo ? 'true' : '');
    img.style.filter = modo ? "invert(0.7)" : "";
  };
})();
</script>

<div class="login-wrapper">
  <div class="login-card">

    
    <div class="login-form-side {% if form.errors %}has-error{% endif %}">
      <div class="login-welcome">¡Bienvenido de nuevo!</div>

      <div class="login-alert-slot">
        {% if form.errors %}
          <div class="alert alert-danger" role="alert">
            Usuario o contraseña incorrectos. Intenta de nuevo.
          </div>
        {% endif %}
        {% if messages %}
          {% for message in messages %}
            {% if "error" in message.tags %}
              <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="close" data-dismiss="alert" aria-label="Cerrar">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
            {% endif %}
          {% endfor %}
        {% endif %}
      </div>

      <form method="post" action="/login/" style="margin-bottom: 6px;" autocomplete="off">
        {% csrf_token %}
        <div class="form-group mb-4 login-field-wrap">
          {{ form.username|add_class:"form-control"|attr:"placeholder:Usuario o correo"|attr:"autocomplete:off" }}
        </div>
        <div class="form-group mb-4 login-field-wrap">
          <div class="login-password-wrap">
            {{ form.password|add_class:"form-control"|attr:"placeholder:Contraseña"|attr:"autocomplete:new-password"|attr:"id:id_login_password" }}
            <button type="button"
                    class="login-password-toggle"
                    data-target="id_login_password"
                    data-visible="false"
                    aria-label="Mostrar u ocultar contraseña">
              <img src="{% static 'img/mostrar_contrasena.png' %}" alt="Mostrar contraseña">
            </button>
          </div>
        </div>
        <button type="submit" class="btn btn-green">
          Iniciar sesión
        </button>
      </form>

      <div style="text-align:center;">
        <a class="login-link" href="{% url 'taxis:password_reset' %}">
          ¿Olvidaste tu contraseña?
        </a>
      </div>

      <div class="register-box">
        <span class="no-account-text">¿No tienes una cuenta?</span>
        <a href="{% url 'taxis:select_role' %}" class="register-highlight">
          Regístrate aquí
        </a>
      </div>
    </div>

    
    <div class="login-logo-side">
      <img src="{% static 'img/logo.png' %}" alt="Logo cooperativa">
      <div class="login-title">Asociación Cooperativa</div>
      <div class="login-org">WILSON TORRES 33 RL</div>
      <div class="login-foot">2026 © | Política de Privacidad</div>
    </div>

  </div>
</div>

<script>
/*
  Lógica del "ojito" para mostrar/ocultar la contraseña:
  - Cambia el tipo del input (password/text).
  - Alterna el ícono de mostrar/ocultar.
*/
document.addEventListener('click', function(e){
  const btn = e.target.closest('.login-password-toggle');
  if (!btn) return;
  const targetId = btn.getAttribute('data-target');
  const input = document.getElementById(targetId);
  if (!input) return;
  const visible = btn.getAttribute('data-visible') === 'true';
  const img = btn.querySelector('img');
  if (visible) {
    input.type = 'password';
    btn.setAttribute('data-visible', 'false');
    img.src = "{% static 'img/mostrar_contrasena.png' %}";
    img.alt = "Mostrar contraseña";
  } else {
    input.type = 'text';
    btn.setAttribute('data-visible', 'true');
    img.src = "{% static 'img/ocultar_contrasena.png' %}";
    img.alt = "Ocultar contraseña";
  }
});
</script>
{% endblock %}